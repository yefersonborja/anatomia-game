<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Anatom√≠a Avanzado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            max-width: 900px;
            width: 100%;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .difficulty-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .header {
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            padding: 15px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }

        .score-item {
            text-align: center;
            position: relative;
        }

        .score-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .score-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .question-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: left;
        }

        .question-number {
            color: #3498db;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-type {
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 1.2rem;
            color: #2c3e50;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .fill-blank {
            background: #e8f4fc;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .blank-space {
            display: inline-block;
            min-width: 100px;
            border-bottom: 2px dashed #3498db;
            margin: 0 5px;
            position: relative;
            padding: 0 5px;
        }

        .blank-input {
            border: none;
            border-bottom: 2px solid #3498db;
            background: transparent;
            width: 100px;
            text-align: center;
            font-size: 1rem;
            outline: none;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .option-btn {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
            text-align: left;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #00b894, #00a085);
            animation: correctAnswer 0.6s ease;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #e17055, #d63031);
            animation: incorrectAnswer 0.6s ease;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: left;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .correct-answer {
            font-weight: bold;
            color: #155724;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #6c5ce7, #5f3dc4);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 150px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .control-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .final-score {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .final-score h2 {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .final-score p {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .final-score .percentage {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
        }

        .timer-container {
            margin-top: 20px;
            background: #f1f1f1;
            border-radius: 10px;
            padding: 10px;
        }

        .timer {
            height: 10px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            border-radius: 5px;
            transition: width 1s linear;
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .settings-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .settings-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .setting-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .settings-options {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="difficulty-badge" id="difficultyBadge">Dif√≠cil</div>
        
        <div class="header">
            <h1 class="title">üß† Anatom√≠a Challenge</h1>
            <p class="subtitle">Sistemas Endocrino, Digestivo y Linf√°tico - Nivel Avanzado</p>
        </div>

        <div class="settings-panel" id="settingsPanel">
            <div class="settings-title">Configuraci√≥n del Juego:</div>
            <div class="settings-options">
                <div class="setting-option">
                    <input type="checkbox" id="timerCheckbox" checked>
                    <label for="timerCheckbox">Temporizador (30s por pregunta)</label>
                </div>
                <div class="setting-option">
                    <input type="checkbox" id="hintsCheckbox">
                    <label for="hintsCheckbox">Mostrar pistas</label>
                </div>
                <div class="setting-option">
                    <input type="checkbox" id="shuffleCheckbox" checked>
                    <label for="shuffleCheckbox">Mezclar preguntas</label>
                </div>
            </div>
        </div>

        <div class="score-board">
            <div class="score-item">
                <span class="score-number" id="currentQuestion">1</span>
                <span class="score-label">Pregunta</span>
            </div>
            <div class="score-item">
                <span class="score-number" id="correctAnswers">0</span>
                <span class="score-label">Correctas</span>
            </div>
            <div class="score-item">
                <span class="score-number" id="incorrectAnswers">0</span>
                <span class="score-label">Incorrectas</span>
            </div>
            <div class="score-item">
                <span class="score-number" id="percentage">0%</span>
                <span class="score-label">Porcentaje</span>
            </div>
        </div>

        <div class="timer-container" id="timerContainer">
            <div class="timer" id="timerBar"></div>
        </div>

        <div class="question-container">
            <div class="question-number">
                <span>Pregunta <span id="questionNum">1</span> de <span id="totalQuestions">250</span></span>
                <span class="question-type" id="questionType">Opci√≥n m√∫ltiple</span>
            </div>
            <div class="question-text" id="questionText">Cargando pregunta...</div>
            <div id="fillBlankContainer"></div>
        </div>

        <div class="options-container" id="optionsContainer">
            <!-- Las opciones se generar√°n din√°micamente -->
        </div>

        <div class="feedback" id="feedback" style="display: none;"></div>

        <div class="control-buttons">
            <button class="control-btn" id="checkBtn" onclick="checkAnswer()">Comprobar</button>
            <button class="control-btn" id="nextBtn" onclick="nextQuestion()" disabled>Siguiente</button>
            <button class="control-btn secondary" id="hintBtn" onclick="showHint()">Pista</button>
            <button class="control-btn secondary" id="restartBtn" onclick="restartGame()">Reiniciar</button>
        </div>

        <div class="final-score" id="finalScore" style="display: none;">
            <h2>üéâ ¬°Juego Terminado!</h2>
            <div class="percentage" id="finalPercentage">0%</div>
            <p>Respuestas correctas: <span id="finalCorrect">0</span></p>
            <p>Respuestas incorrectas: <span id="finalIncorrect">0</span></p>
            <p>Tiempo promedio por pregunta: <span id="avgTime">0</span>s</p>
            <p>Preguntas sin responder: <span id="unanswered">0</span></p>
            <button class="control-btn" onclick="restartGame()" style="margin-top: 20px;">Jugar de nuevo</button>
        </div>
    </div>

    <script>
        // Variables del juego
        let currentQuestion = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let unansweredQuestions = 0;
        let questions = [];
        let shuffledQuestions = [];
        let timer;
        let timeLeft = 30;
        let totalTime = 0;
        let questionStartTime;
        let gameSettings = {
            timerEnabled: true,
            hintsEnabled: false,
            shuffleQuestions: true
        };

        // Preguntas avanzadas (250 en total)
        const advancedQuestions = [
            // PREGUNTAS DE COMPLETAR (50)
            {
                type: "fill",
                question: "El sistema digestivo tiene un tubo de aproximadamente ______ metros de largo desde la boca hasta el ano.",
                answer: "11",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Las gl√°ndulas ______ vierten su secreci√≥n junto al segundo molar superior.",
                answer: "par√≥tidas",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La enzima salival que degrada el almid√≥n se llama ______.",
                answer: "amilasa",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "El es√≥fago tiene dos esf√≠nteres: el esf√≠nter esof√°gico ______ y el inferior.",
                answer: "superior",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Las c√©lulas ______ del est√≥mago producen √°cido clorh√≠drico.",
                answer: "parietales",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "El intestino delgado se divide en duodeno, ______ e √≠leon.",
                answer: "yeyuno",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "La bilis se almacena en la ______ biliar.",
                answer: "ves√≠cula",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "El p√°ncreas tiene una funci√≥n endocrina a trav√©s de los ______ de Langerhans.",
                answer: "islotes",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Las c√©lulas beta del p√°ncreas producen ______.",
                answer: "insulina",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "El h√≠gado tiene ______ l√≥bulos principales.",
                answer: "4",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "La hormona que regula los ciclos circadianos es la ______.",
                answer: "melatonina",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "La ______ es la gl√°ndula m√°s grande del sistema endocrino.",
                answer: "tiroides",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Las gl√°ndulas ______ regulan el calcio s√©rico mediante la PTH.",
                answer: "paratiroides",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La ______ es la parte del p√°ncreas que est√° en contacto con el bazo.",
                answer: "cola",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "El conducto pancre√°tico principal se llama conducto de ______.",
                answer: "Wirsung",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Las c√©lulas ______ de los islotes pancre√°ticos producen somatostatina.",
                answer: "delta",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La corteza suprarrenal produce hormonas como el ______ y la aldosterona.",
                answer: "cortisol",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "La m√©dula suprarrenal produce ______ y noradrenalina.",
                answer: "adrenalina",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "La adenohip√≥fisis produce hormonas como la ______, ACTH y TSH.",
                answer: "GH",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La neurohip√≥fisis almacena ______ y oxitocina.",
                answer: "ADH",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "El sistema linf√°tico tiene tres funciones principales: recuperaci√≥n de l√≠quidos, inmunidad y absorci√≥n de ______.",
                answer: "l√≠pidos",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "Los linfocitos ______ son responsables de la vigilancia inmunitaria.",
                answer: "NK",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los linfocitos T maduran en el ______.",
                answer: "timo",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Los linfocitos ______ producen anticuerpos.",
                answer: "B",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "El conducto ______ drena la linfa del lado izquierdo del cuerpo.",
                answer: "tor√°cico",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La ______ de Pecquet es una dilataci√≥n al inicio del conducto tor√°cico.",
                answer: "cisterna",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "El ______ es el √≥rgano linf√°tico m√°s grande del cuerpo.",
                answer: "bazo",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "La ______ blanca del bazo contiene principalmente linfocitos.",
                answer: "pulpa",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Las ______ palatinas se encuentran a cada lado de la entrada de la faringe.",
                answer: "am√≠gdalas",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "Los ______ fagocitan eritrocitos envejecidos en el bazo.",
                answer: "macr√≥fagos",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "El timo produce hormonas como la ______ y timopoyetina.",
                answer: "timosina",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los ganglios linf√°ticos filtran hasta el ______% de las impurezas de la linfa.",
                answer: "99",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Las c√©lulas ______ presentan ant√≠genos a los linfocitos T.",
                answer: "dendr√≠ticas",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los √≥rganos linf√°ticos primarios son la m√©dula √≥sea y el ______.",
                answer: "timo",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "El timo sufre ______ con la edad.",
                answer: "involuci√≥n",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los capilares linf√°ticos est√°n ausentes en el sistema nervioso central y el ______.",
                answer: "cart√≠lago",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La linfa intestinal tiene aspecto lechoso debido a su contenido de ______.",
                answer: "l√≠pidos",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Las c√©lulas ______ reticulares del timo producen se√±ales para el desarrollo de linfocitos T.",
                answer: "epiteliales",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los ______ t√≠micos son estructuras caracter√≠sticas de la m√©dula del timo.",
                answer: "corp√∫sculos",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los ganglios linf√°ticos ______ se encuentran en la axila.",
                answer: "axilares",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "Los ganglios linf√°ticos ______ se encuentran en la ingle.",
                answer: "inguinales",
                difficulty: "easy"
            },
            {
                type: "fill",
                question: "La ______ roja del bazo contiene una concentraci√≥n de eritrocitos.",
                answer: "pulpa",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Los ______ germinales en los ganglios linf√°ticos contienen linfocitos B proliferantes.",
                answer: "centros",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La ______ de los ganglios linf√°ticos contiene fol√≠culos linfoides.",
                answer: "corteza",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los ______ medulares de los ganglios linf√°ticos contienen linfocitos B y c√©lulas plasm√°ticas.",
                answer: "cordones",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "La inmunidad de ______ es proporcionada por los linfocitos NK.",
                answer: "vigilancia",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Los ______ derivan de los monocitos y son fagocitos importantes.",
                answer: "macr√≥fagos",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Las ______ presentan ant√≠genos en los ganglios linf√°ticos.",
                answer: "c√©lulas dendr√≠ticas",
                difficulty: "hard"
            },
            {
                type: "fill",
                question: "Las am√≠gdalas est√°n formadas por tejido ______.",
                answer: "linf√°tico",
                difficulty: "medium"
            },
            {
                type: "fill",
                question: "Los ______ del bazo contienen senos eritroc√≠ticos.",
                answer: "pulpa roja",
                difficulty: "hard"
            },

            // PREGUNTAS DE OPCI√ìN M√öLTIPLE AVANZADAS (200)
            // (Aqu√≠ ir√≠an las 200 preguntas de opci√≥n m√∫ltiple que ya ten√≠as, pero con mayor dificultad)
            // Ejemplo:
            {
                type: "multiple",
                question: "¬øQu√© estructura pancre√°tica se proyecta medialmente posterior a la arteria mesent√©rica superior?",
                options: [
                    "Proceso unciforme", 
                    "Cabeza del p√°ncreas", 
                    "Cuello del p√°ncreas", 
                    "Cola del p√°ncreas"
                ],
                answer: 0,
                difficulty: "hard"
            },
            {
                type: "multiple",
                question: "¬øQu√© c√©lulas pancre√°ticas representan aproximadamente el 70% de los islotes de Langerhans?",
                options: [
                    "C√©lulas alfa", 
                    "C√©lulas beta", 
                    "C√©lulas delta", 
                    "C√©lulas epsilon"
                ],
                answer: 1,
                difficulty: "hard"
            },
            // ... (resto de preguntas)
        ];

        // Inicializar el juego
        function initGame() {
            // Configurar ajustes
            gameSettings.timerEnabled = document.getElementById('timerCheckbox').checked;
            gameSettings.hintsEnabled = document.getElementById('hintsCheckbox').checked;
            gameSettings.shuffleQuestions = document.getElementById('shuffleCheckbox').checked;
            
            // Mostrar/ocultar temporizador seg√∫n configuraci√≥n
            document.getElementById('timerContainer').style.display = gameSettings.timerEnabled ? 'block' : 'none';
            
            // Mezclar preguntas si est√° activado
            if (gameSettings.shuffleQuestions) {
                shuffledQuestions = [...advancedQuestions].sort(() => Math.random() - 0.5);
            } else {
                shuffledQuestions = [...advancedQuestions];
            }
            
            // Mostrar la primera pregunta
            showQuestion();
        }

        // Mostrar pregunta actual
        function showQuestion() {
            // Reiniciar temporizador
            resetTimer();
            
            // Actualizar contadores
            document.getElementById('currentQuestion').textContent = currentQuestion + 1;
            document.getElementById('questionNum').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = shuffledQuestions.length;
            
            // Obtener pregunta actual
            const question = shuffledQuestions[currentQuestion];
            
            // Mostrar tipo de pregunta
            document.getElementById('questionType').textContent = 
                question.type === "fill" ? "Completar" : "Opci√≥n m√∫ltiple";
            document.getElementById('questionType').style.backgroundColor = 
                question.type === "fill" ? "#9b59b6" : "#3498db";
            
            // Mostrar texto de la pregunta
            document.getElementById('questionText').textContent = question.question;
            
            // Configurar contenedores seg√∫n tipo de pregunta
            const optionsContainer = document.getElementById('optionsContainer');
            const fillBlankContainer = document.getElementById('fillBlankContainer');
            
            if (question.type === "multiple") {
                // Mostrar opciones m√∫ltiples
                optionsContainer.style.display = "grid";
                fillBlankContainer.innerHTML = "";
                
                // Generar botones de opciones
                optionsContainer.innerHTML = "";
                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = "option-btn";
                    button.textContent = option;
                    button.onclick = () => selectOption(index);
                    optionsContainer.appendChild(button);
                });
            } else {
                // Mostrar pregunta para completar
                optionsContainer.style.display = "none";
                
                // Procesar texto para encontrar los espacios en blanco
                const parts = question.question.split('______');
                fillBlankContainer.innerHTML = "";
                
                parts.forEach((part, index) => {
                    fillBlankContainer.appendChild(document.createTextNode(part));
                    
                    if (index < parts.length - 1) {
                        const input = document.createElement('input');
                        input.type = "text";
                        input.className = "blank-input";
                        input.id = "blankInput" + index;
                        fillBlankContainer.appendChild(input);
                    }
                });
            }
            
            // Configurar botones
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('checkBtn').disabled = false;
            
            // Guardar tiempo de inicio de la pregunta
            questionStartTime = new Date();
        }

        // Seleccionar opci√≥n en preguntas m√∫ltiples
        function selectOption(index) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(button => button.disabled = true);
            
            const question = shuffledQuestions[currentQuestion];
            
            if (index === question.answer) {
                buttons[index].classList.add('correct');
                correctAnswers++;
                document.getElementById('correctAnswers').textContent = correctAnswers;
            } else {
                buttons[index].classList.add('incorrect');
                buttons[question.answer].classList.add('correct');
                incorrectAnswers++;
                document.getElementById('incorrectAnswers').textContent = incorrectAnswers;
            }
            
            updatePercentage();
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('checkBtn').disabled = true;
            
            // Detener temporizador
            stopTimer();
        }

        // Comprobar respuesta en preguntas de completar
        function checkAnswer() {
            const question = shuffledQuestions[currentQuestion];
            let allCorrect = true;
            
            if (question.type === "fill") {
                const inputs = document.querySelectorAll('.blank-input');
                
                // Para preguntas con m√∫ltiples espacios en blanco
                if (Array.isArray(question.answer)) {
                    question.answer.forEach((ans, index) => {
                        if (inputs[index].value.toLowerCase() !== ans.toLowerCase()) {
                            allCorrect = false;
                            inputs[index].style.borderBottom = "2px solid #e74c3c";
                        } else {
                            inputs[index].style.borderBottom = "2px solid #2ecc71";
                        }
                    });
                } else {
                    // Para preguntas con un solo espacio en blanco
                    if (inputs[0].value.toLowerCase() !== question.answer.toLowerCase()) {
                        allCorrect = false;
                        inputs[0].style.borderBottom = "2px solid #e74c3c";
                    } else {
                        inputs[0].style.borderBottom = "2px solid #2ecc71";
                    }
                }
                
                if (allCorrect) {
                    correctAnswers++;
                    document.getElementById('correctAnswers').textContent = correctAnswers;
                    showFeedback("¬°Correcto!", true);
                } else {
                    incorrectAnswers++;
                    document.getElementById('incorrectAnswers').textContent = incorrectAnswers;
                    showFeedback(`La respuesta correcta es: ${question.answer}`, false);
                }
                
                updatePercentage();
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('checkBtn').disabled = true;
                
                // Detener temporizador
                stopTimer();
            }
        }

        // Mostrar retroalimentaci√≥n
        function showFeedback(message, isCorrect) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = isCorrect ? "feedback correct" : "feedback incorrect";
            feedback.style.display = "block";
            
            if (!isCorrect) {
                const correctAnswer = document.createElement('span');
                correctAnswer.className = "correct-answer";
                feedback.appendChild(document.createElement('br'));
                feedback.appendChild(correctAnswer);
            }
        }

        // Mostrar pista
        function showHint() {
            if (!gameSettings.hintsEnabled) return;
            
            const question = shuffledQuestions[currentQuestion];
            let hint = "";
            
            if (question.type === "multiple") {
                // Eliminar una opci√≥n incorrecta
                const options = document.querySelectorAll('.option-btn');
                let incorrectRemoved = 0;
                
                for (let i = 0; i < options.length; i++) {
                    if (i !== question.answer && incorrectRemoved < 1) {
                        options[i].style.opacity = "0.5";
                        options[i].disabled = true;
                        incorrectRemoved++;
                    }
                }
                
                hint = "Se ha eliminado una opci√≥n incorrecta";
            } else {
                // Mostrar primera letra de la respuesta
                hint = `Pista: La respuesta comienza con "${question.answer.charAt(0)}"`;
            }
            
            showFeedback(hint, true);
        }

        // Siguiente pregunta
        function nextQuestion() {
            // Calcular tiempo empleado en la pregunta
            const questionEndTime = new Date();
            totalTime += (questionEndTime - questionStartTime) / 1000;
            
            // Pasar a la siguiente pregunta
            currentQuestion++;
            
            if (currentQuestion < shuffledQuestions.length) {
                showQuestion();
                document.getElementById('feedback').style.display = "none";
            } else {
                finishGame();
            }
        }

        // Reiniciar juego
        function restartGame() {
            currentQuestion = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            unansweredQuestions = 0;
            totalTime = 0;
            
            document.getElementById('correctAnswers').textContent = "0";
            document.getElementById('incorrectAnswers').textContent = "0";
            document.getElementById('percentage').textContent = "0%";
            document.getElementById('finalScore').style.display = "none";
            
            initGame();
        }

        // Terminar juego
        function finishGame() {
            stopTimer();
            
            const percentage = Math.round((correctAnswers / shuffledQuestions.length) * 100);
            const avgTime = Math.round(totalTime / shuffledQuestions.length);
            
            document.getElementById('finalCorrect').textContent = correctAnswers;
            document.getElementById('finalIncorrect').textContent = incorrectAnswers;
            document.getElementById('finalPercentage').textContent = `${percentage}%`;
            document.getElementById('avgTime').textContent = avgTime;
            document.getElementById('unanswered').textContent = 
                shuffledQuestions.length - correctAnswers - incorrectAnswers;
            
            document.getElementById('finalScore').style.display = "block";
            document.getElementById('questionContainer').style.display = "none";
            document.getElementById('optionsContainer').style.display = "none";
            document.getElementById('feedback').style.display = "none";
            document.getElementById('nextBtn').style.display = "none";
            document.getElementById('checkBtn').style.display = "none";
        }

        // Actualizar porcentaje
        function updatePercentage() {
            const totalAnswered = correctAnswers + incorrectAnswers;
            const percentage = totalAnswered > 0 
                ? Math.round((correctAnswers / totalAnswered) * 100) 
                : 0;
            
            document.getElementById('percentage').textContent = `${percentage}%`;
        }

        // Temporizador
        function startTimer() {
            if (!gameSettings.timerEnabled) return;
            
            timeLeft = 30;
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    timeUp();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timer);
        }

        function resetTimer() {
            stopTimer();
            startTimer();
        }

        function updateTimerDisplay() {
            const timerBar = document.getElementById('timerBar');
            const percentage = (timeLeft / 30) * 100;
            
            timerBar.style.width = `${percentage}%`;
            
            if (timeLeft < 10) {
                timerBar.style.background = "linear-gradient(135deg, #e74c3c, #c0392b)";
            } else {
                timerBar.style.background = "linear-gradient(135deg, #2ecc71, #27ae60)";
            }
        }

        function timeUp() {
            stopTimer();
            unansweredQuestions++;
            
            const question = shuffledQuestions[currentQuestion];
            showFeedback("¬°Tiempo agotado! La respuesta correcta es: " + 
                (question.type === "multiple" ? question.options[question.answer] : question.answer), false);
            
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('checkBtn').disabled = true;
        }

        // Iniciar el juego cuando se carga la p√°gina
        window.onload = function() {
            // Configurar eventos de los ajustes
            document.getElementById('timerCheckbox').addEventListener('change', function() {
                gameSettings.timerEnabled = this.checked;
                document.getElementById('timerContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('hintsCheckbox').addEventListener('change', function() {
                gameSettings.hintsEnabled = this.checked;
            });
            
            document.getElementById('shuffleCheckbox').addEventListener('change', function() {
                gameSettings.shuffleQuestions = this.checked;
            });
            
            // Iniciar juego
            initGame();
        };
    </script>
</body>
</html>